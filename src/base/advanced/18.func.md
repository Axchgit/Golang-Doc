

# 函数



函数是大部分高级语言都具有的特性，笔者先前学习的是java，更多的是称此为方法，然而在Go语言中函数与方法是两个相似但又不同的概念

在Go语言的官方介绍中，函数是Go语言的**一等公民**，是最基本的代码块，用于执行一个任务逻辑

Go语言中至少要有一个`main`函数或者`init`函数



## 定义

Go语言函数的定义格式如下：

```go
func 函数名([参数列表]) [返回值] {
	函数体
}
```



**`func`**:用于声明一个函数的关键字

**`函数名`**:函数名称，函数列表，返回值类型 这三者构成了函数签名

**`参数类别`**:参数就像一个占位符，你可以将值传递给这些参数从而达到值传递的效果，参数列表是可以为空

**`返回类型`**:即代表这个函数被调用完成后会返回的值类型，也可以没有返回值

**`函数体`**:函数内部的代码集合





**示例**

这是很简单的将两个数相加的函数

```go
func sum(a int, b int) int {
    return a + b;
}
```



## 函数的调用

`main`函数是Go中的启动函数，至于为什么笔者不会在这里深究，几乎所有的高级语言都有`main`函数

接下来我们在`main`函数中调用求和的函数并输出结果

```go
func main() {
	a := 1
	b := 2
	res := sum(a, b)
	fmt.Printf("%d + %d = %d", a, b, res)
}
```

运行结果为

```go
1 + 2 = 3
```



## 多返回值

Go中的函数可以有多个返回值，接触过c/c++的人都应该有了解过用指针编写交换两数的值的程序，在Go语言也可以不用指针完成此程序

```Go
func main() {
	a := 1
	b := 2
	fmt.Println(a, b)
	a, b = swap(a, b)
	fmt.Println(a, b)
}


func swap(a int, b int) (int, int) {
	return b, a
}
```

运行结果为

```
1 2
2 1
```

在接收多返回值时，可以用`val, val... = function(param) `这种方式接收。



## 参数

函数中的参数被称为形参，就像定义在函数内部的局部变量

函数参数在Go语言中有两种传递方式，在默认情况下，Go语言使用的是**值传递**

| 传递类型 | 描述                                                         |
| -------- | ------------------------------------------------------------ |
| 值传递   | 值传递指在函数调用时，将实际参数的值拷贝传递到函数中，修改函数的形参不会对实参有任何影响 |
| 址传递   | 址传递指在函数调用时，将实际参数的地址传递的拷贝传递到函数当中，由于传递的是地址，指向的是同一个数据，修改将会影响到实参 |



上一个sum函数是一个典型的值传递例子，接下来我们用址传递来写一个同样的程序

```go
func swap(a *int, b *int) {
	*a, *b = *b, *a
}
```

这个例子用到了指针，并且不需要返回值，因为直接操作了对应地址内存的数据，使得实际参数的值被修改。



**变长参数**

一个函数不确定会接收多少个参数时，可以用变长参数来接收，需要注意的是变长参数必须位于参数列表的末尾

变长参数本质上是一个数组

小明想要对一些数字求和，但是又不确定自己会传入多少个数字，每一次的数量都可能是不相同的，并且希望每一次都能得到正确的结果

```go
func flexSum(nums ...int) (sum int) {
	for _, v := range nums {
		sum += v
	}
	return
}
```

这段程序里用到了`for range`循环，并且由于我们只需要用到数组的值而非下标，还用到了`匿名变量`来接收下标。

除此之外，会发现`return`关键字后没有跟任何变量，并且原本是函数返回值声明的地方有着一个类似参数声明的语句，这些内容将会在下文中的返回值部分讲到。



## 返回值

关于Go中的返回值可能与其他语言略有区别：

- Go语言中可以直接声明返回值的名称
- 当`return`关键字指定了返回名称时，返回值可以不需要有名称
- 当`return`关键字未指定返回名称时，返回值必须带上名称
- 当返回值有名称时，必须用括号包围，就算只有一个返回值
- 即便返回值有名称时，`return`也可以指定返回其他的名称，即`return`的**优先级最高**
- 已经声明了的返回值名称在函数内可以直接当作局部变量使用，无需再次声明，否则编译不通过
- `return`关键字可以接表达式，但不允许出现赋值表达式



```go
func getInfo() (money int, rate float64)  {
	money = 100
	rate = 1.5
	return money,rate
}
```

这是一段获取货币信息的程序，返回值分别是`money`和`rate`，因为返回值部分已经声明了名称，所以`return`部分可以简化成如下程序

```go
func getInfo() (money int, rate float64) {
    money = 100
    rate = 1.5
    return
}
```

也可以强行覆盖

```go
func getInfo() (money int, rate float64) {
	m := 100
	r := 1.5
	return m, r
}
```



## 参数函数

Go语言可以很灵活的创建函数，并且可以作为另一个函数的实参，且可以在另一个函数中被调用。

接下来我们通过这种特性来实现一个回调函数，还是一个非常典型的数字例子

不过这一次我们希望如果结果为奇数，就返会true，如果求和结果为偶数就返回false，此函数接收一个参数函数，这个参数函数被成为回调

调用函数不关心回调函数内部是如何处理逻辑的，它只关心返回值，并且回调函数的内部实现，需要调用者自己编写

```go
func main() {

	fmt.Println(isOdd(1, 2, func(a int, b int) int {
		return a + b
	}))

}

func isOdd(a int, b int, callback func(a int, b int) int) bool {
	return callback(a, b)%2 == 1
}
```

这段程序中，传入了一个匿名的函数作为参数，在`isOdd`函数内部调用了这个函数的返回值并判断是不是奇数

如果在Java中，这一个函数参数可以被声明为一个Lamda接口，从而简化为Lambda表达式

如果是Js中，可以简化为箭头函数，Js对于回调的应用非常广泛，但也会引发一系列问题，在Go中也是如此，关于这个问题会在下一章节详细讲到。



## 闭包

Go语言支持匿名函数，就像很多其他高级语言也支持一样。匿名函数是一个内联语句或者表达式

匿名函数可以直接访问函数中的变量而不必声明，也可以直接访问函数的参数

```go
func main() {

    //这里也可以看到函数除了可以作为参数，也可以作为返回值
	add := initial(10)

	fmt.Println(add(20))
	fmt.Println(add(30))
	fmt.Println(add(40))
	fmt.Println(add(50))

}

func initial(init int) func(int) int {
	//外部函数的变量
	x := init
	return func(y int) int {
		//内部函数的变量
		x += y
		return x
	}
}
```

输出结果为

```go
30
60 
100
150
```

内部函数可以直接访问到变量x，并执行多次累加操作，你可能会好奇为什么不是输出以下结果

```
20
30
40
50
```

这涉及到了Go语言的变量作用域问题，笔者将会在下一章节中讲到，可以暂时只做了解



